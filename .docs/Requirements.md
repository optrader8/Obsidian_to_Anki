# Obsidian to Anki - 요구사항 명세서

## 1. 프로젝트 개요

Obsidian의 마크다운 파일에서 Anki 플래시카드를 자동으로 생성하고, LLM을 활용하여 스마트한 카드 생성 및 해답 생성을 지원하는 시스템.

## 2. 기존 기능 요구사항

### 2.1 핵심 기능
- **양방향 동작 모드**
  - Obsidian 플러그인으로 동작
  - Python 독립 스크립트로 동작

- **AnkiConnect 통합**
  - AnkiConnect API를 통한 Anki와의 통신
  - 카드 생성, 업데이트, 삭제

- **커스텀 노트 타입 지원**
  - Anki의 모든 노트 타입 지원
  - 사용자 정의 정규식 패턴

### 2.2 마크다운 처리
- **다양한 카드 스타일 지원**
  - Basic 카드
  - Cloze 카드
  - RemNote 스타일
  - Header-Paragraph 스타일
  - Question-Answer 스타일
  - Neuracache 스타일
  - Ruled 스타일
  - Markdown Table 스타일
  - Inline Notes

- **마크다운 형식**
  - 마크다운 문법 지원
  - 수식 (Math) 지원
  - 이미지 임베딩
  - 오디오 파일
  - GIF 지원

### 2.3 파일 관리
- **디렉토리 스캔**
  - 전체 Vault 스캔
  - 사용자 지정 디렉토리 스캔
  - 재귀적 서브디렉토리 스캔

- **파일/폴더 제외**
  - Glob 패턴을 통한 파일/폴더 제외
  - 예: `**/*.excalidraw.md`, `Template/**`, `**/private/**`

### 2.4 메타데이터 관리
- **태그 시스템**
  - 파일별 태그
  - 카드별 태그
  - Obsidian 태그 통합

- **덱(Deck) 관리**
  - 파일별 대상 덱 지정
  - 폴더별 덱 매핑
  - 기본 덱 설정

- **고급 기능**
  - Frozen Fields (고정 필드)
  - ID Comments (카드 식별자)
  - 파일 링크 추가
  - 컨텍스트 추가

## 3. 새로운 기능 요구사항

### 3.1 스마트 카드 자동 생성

#### 3.1.1 자동 카드 감지
- **컨텐츠 분석**
  - 마크다운 파일의 내용을 분석하여 플래시카드로 적합한 부분 자동 감지
  - 제목, 소제목, 리스트, 인용구 등의 구조 분석
  - 중요 개념과 정의 자동 추출

- **카드 생성 제안**
  - LLM을 활용한 플래시카드 생성 제안
  - 기존 수동 마크업 방식과 자동 생성 방식의 혼합 사용
  - 생성된 카드에 대한 사용자 확인/수정 옵션

#### 3.1.2 인텔리전트 카드 타입 선택
- **자동 카드 타입 결정**
  - 내용의 특성에 따라 최적의 카드 타입 자동 선택
  - Basic, Cloze, Q&A 등 적절한 형식 자동 결정
  - 사용자 선호도 학습

### 3.2 LLM 통합

#### 3.2.1 LLM 제공자 지원
- **OpenAI 호환 로컬 LLM**
  - Ollama
  - LM Studio
  - LocalAI
  - vLLM
  - 기타 OpenAI API 호환 로컬 서버

- **클라우드 LLM 서비스**
  - OpenRouter
  - OpenAI
  - Anthropic Claude (API)
  - Google Gemini
  - Cohere

#### 3.2.2 LLM 설정 관리
- **프로바이더 설정**
  - API 엔드포인트 설정
  - API 키 관리 (보안)
  - 모델 선택
  - 파라미터 설정 (temperature, max_tokens 등)

- **복수 프로바이더 지원**
  - 우선순위 기반 폴백
  - 프로바이더별 용도 구분 (예: 카드 생성용, 해답 생성용)

#### 3.2.3 프롬프트 관리
- **커스터마이징 가능한 프롬프트**
  - 카드 생성 프롬프트
  - 해답 생성 프롬프트
  - 번역 프롬프트
  - 요약 프롬프트

- **프롬프트 템플릿**
  - 기본 템플릿 제공
  - 사용자 정의 템플릿
  - 노트 타입별 프롬프트

### 3.3 스마트 해답 생성

#### 3.3.1 자동 해답 생성
- **질문 기반 해답 생성**
  - 질문이 주어졌을 때 LLM을 통한 해답 생성
  - 컨텍스트 기반 해답 생성 (파일 내용 참조)
  - 다양한 난이도의 해답 생성

#### 3.3.2 해답 품질 관리
- **해답 검증**
  - 생성된 해답의 정확성 확인
  - 사용자 피드백 수집
  - 재생성 옵션

- **해답 개선**
  - 기존 해답 개선 제안
  - 추가 설명 생성
  - 예시 추가

### 3.4 배치 처리

#### 3.4.1 대량 카드 생성
- **Vault 전체 처리**
  - 전체 마크다운 파일에 대한 일괄 처리
  - 진행 상황 표시
  - 오류 처리 및 로깅

#### 3.4.2 증분 업데이트
- **변경 감지**
  - 파일 해시 기반 변경 감지
  - 수정된 파일만 재처리
  - 기존 카드 업데이트 vs 새 카드 생성

### 3.5 설정 및 UI

#### 3.5.1 플러그인 설정
- **LLM 설정 탭**
  - 프로바이더 선택 및 설정
  - API 키 입력
  - 모델 선택
  - 프롬프트 커스터마이징

- **자동 생성 설정**
  - 자동 생성 활성화/비활성화
  - 생성 전 확인 옵션
  - 배치 크기 설정
  - 재시도 정책

#### 3.5.2 Python 스크립트 설정
- **설정 파일 확장**
  - INI 파일에 LLM 설정 섹션 추가
  - JSON 설정 파일 지원 (복잡한 설정용)

#### 3.5.3 UI 개선
- **프리뷰 기능**
  - LLM 생성 결과 미리보기
  - 수정 인터페이스
  - 승인/거부 버튼

- **진행 상황 표시**
  - 배치 처리 진행률
  - LLM API 호출 상태
  - 에러 메시지

## 4. 비기능 요구사항

### 4.1 성능
- **응답 시간**
  - 단일 카드 생성: < 5초 (LLM 호출 포함)
  - 배치 처리: 파일당 < 10초

- **동시성**
  - 병렬 LLM API 호출 지원
  - 비동기 처리

### 4.2 보안
- **API 키 관리**
  - 암호화된 저장
  - 환경 변수 지원
  - .gitignore에 자동 추가

- **데이터 프라이버시**
  - 로컬 LLM 사용 옵션
  - 데이터 전송 최소화

### 4.3 안정성
- **오류 처리**
  - LLM API 실패 시 폴백
  - 네트워크 오류 재시도
  - 부분 실패 시 계속 진행

- **로깅**
  - 상세한 에러 로그
  - 디버그 모드

### 4.4 호환성
- **Obsidian 버전**
  - 최신 Obsidian 버전 지원
  - 하위 호환성 유지

- **Anki 버전**
  - Anki 2.1.x 지원
  - AnkiConnect 최신 버전

- **Python 버전**
  - Python 3.8 이상

### 4.5 확장성
- **플러그인 아키텍처**
  - 새로운 LLM 프로바이더 쉽게 추가
  - 커스텀 프롬프트 템플릿 시스템
  - 훅(Hook) 시스템

## 5. 제약사항

### 5.1 기술적 제약
- AnkiConnect 필요
- 인터넷 연결 (클라우드 LLM 사용 시)
- Obsidian 플러그인 API 제약

### 5.2 비용 제약
- 클라우드 LLM API 사용 시 비용 발생
- 토큰 사용량 모니터링 필요

### 5.3 라이선스
- MIT 라이선스 준수
- 오픈소스 라이브러리 라이선스 준수

## 6. 우선순위

### P0 (필수)
- LLM 프로바이더 기본 통합 (OpenAI 호환)
- 스마트 카드 생성 기본 기능
- 플러그인 설정 UI

### P1 (중요)
- 복수 LLM 프로바이더 지원
- 자동 해답 생성
- 배치 처리

### P2 (부가)
- 프롬프트 커스터마이징
- 프리뷰 UI
- 고급 설정

## 7. 성공 기준

- 사용자가 마크다운 파일을 작성하면 자동으로 플래시카드 제안
- LLM을 통한 카드 생성이 수동 작성 대비 50% 이상 시간 절약
- 생성된 카드의 품질이 사용자 기대치 충족 (사용자 피드백 기반)
- 기존 기능과의 완벽한 호환성 유지
